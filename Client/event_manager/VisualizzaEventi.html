<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet"href="https://localhost:10000/style">
</head>
<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>

      function redistribuisci(address){
        fetch("https://localhost:10000/redistribuisci?address=" + address)
          .then(function (response) {
            return response.json();
          })
          .then(function (myJson) {
            if(myJson.stato == "successo"){
              alert("Redistribuzione eseguita! Hai guadagnato: " + myJson.incasso + "€.")
            } else if (myJson.stato == "pagato"){
              alert("Redistribuzione incassi già effettuata");
            } else {
              alert("Si è verificato un errore!")
            }
          })
          .catch(function (error) {
            console.log("Error: " + error);
          });
      }

      fetch("https://localhost:10000/eventi")
        .then(function (response) {
          return response.json();
        })
        .then(function (myJson) {
          const tabellaEventi = document.querySelector("#eventi");
          $(document).ready(function () {
                var json = myJson;
                var tr;
                for (var i = 0; i < json.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td>" + json[i].nome + "</td>");
                    tr.append("<td>" + json[i].data + "</td>");
                    tr.append("<td>" + json[i].numPosti + "</td>");
                    tr.append("<td>" + json[i].prezzoBiglietto + "</td>");
                    tr.append("<td>" + json[i].ticketCounter + "</td>");
                    tr.append("<td>" + json[i].address + "</td>");
                    tr.append("<td>" + json[i].luogo + "</td>");
                    tr.append("<td>" + json[i].stato + "</td>");
                    tr.append("<td>" + (json[i].prezzoBiglietto*json[i].ticketCounter) + "€</td>");
                    if(json[i].stato == "terminato"){
                      tr.append("<td><button id=\"btnredis\" class=\"bottone\" onClick = 'redistribuisci(\"" + json[i].address + "\"" + ")'\">Redistribuisci</button>" +
                                "</td>");
                    } else {
                      tr.append("<td><button class=\"bottone\" onClick = \"window.location.href='https://localhost:10000/modificaevento?address=" + json[i].address + "'\">Modifica</button>" +
                                "</td>");
                    }

                    $('table').append(tr);
                }
        });

        })
        .catch(function (error) {
          console.log("Error: " + error);
        });
    </script>

<ul>
  <li><a href="https://localhost:10000/">Home</a></li>
  <li><a href="https://localhost:10000/creaevento">Crea Evento</a></li>
  <li><a class="active" href="https://localhost:10000/visualizzaeventi">Visualizza Eventi</a></li>
</ul>

<div style="padding:20px;margin-top:30px;background-color:#1abc9c;height:1500px;">
  <div class="riquadro">

  <h1>Visualizza Eventi</h1>

  <table id="eventi">
    <tr>
      <th>Nome dell'Evento</th>
      <th>Data</th>
      <th>Numero posti</th>
      <th>Prezzo biglietto</th>
      <th>Biglietti venduti</th>
      <th>Indirizzo</th>
      <th>Luogo</th>
      <th>Stato</th>
      <th>Guadagno</th>
      <th>Opzioni</th>
    </tr>
  </table>

</div>
</div>

</body>
</html>
