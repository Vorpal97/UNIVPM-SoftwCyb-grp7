<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet"href="https://localhost:10000/style">
</head>
<body>
  <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
  <script>

      $(function(){
        var date = new Date();
        date.setDate(date.getDate() + 7);

        var month = date.getMonth() + 1;
        var day = date.getDate();
        var year = date.getFullYear();

        if(month < 10)
            month = '0' + month.toString();
        if(day < 10)
            day = '0' + day.toString();


        var maxDate = year + '-' + month + '-' + day;
        $('#eventDate').attr('min', maxDate);
    });

    function annulla(){
      window.location.href='https://localhost:10000/visualizzaeventi';
    }

    function inviaDati(){

      obj = {
        eventName : document.getElementById("eventName").value,
        eventDate : document.getElementById("eventDate").value,
        eventPlace : document.getElementById("eventPlace").value,
        eventNPosti : document.getElementById("eventNPosti").value,
        eventPrice : document.getElementById("eventPrice").value
      }

      if(obj.eventName == "" || obj.eventDate == "" || obj.eventPlace == "" || obj.eventNPosti == "" || obj.eventPrice == ""){
        document.getElementById("outputBox").innerHTML = "Controlla che tutti i campi siano valorizzati"
      } else {
        if(/^\d+$/.test(obj.eventNPosti) && /^\d+$/.test(obj.eventPrice)){
          document.getElementById("outputBox").innerHTML = ""
          console.log(obj)
          $.ajax({
             type: "POST",
             url: "https://localhost:10000/nuovoevento",
             data: obj,
             success: function(d) {
               console.log(d)
               if(d.stato == "successo"){
                 alert("Evento creato correttamente!");
                 window.location.href='https://localhost:10000/visualizzaeventi';
               } else {
                 alert("Si Ã¨ verificato un errore");
               }
             }
          });
        } else {
          document.getElementById("outputBox").innerHTML = "Controlla che il prezzo del biglietto e il numero dei posti siano valori numerici"
        }
      }
    }
  </script>

<ul>
  <li><a href="https://localhost:10000/">Home</a></li>
  <li><a class="active" href="https://localhost:10000/creaevento">Crea Evento</a></li>
  <li><a href="https://localhost:10000/visualizzaeventi">Visualizza Eventi</a></li>
</ul>

<div style="padding:20px;margin-top:30px;background-color:#1abc9c;height:1500px;">
  <div class="center">
    <div class="riquadro riquadroDati">
      <h1>Crea Evento</h1>

      <form id="input" autocomplete="off">
          <label>Nome dell'evento:</label><br>
          <input type='text' id='eventName' required><br>
          <label>Data dell'evento:</label><br>
          <input type='date' id='eventDate' required pattern="\d{4}-\d{2}-\d{2}"><br>
          <label>Luogo dell'evento:</label><br>
          <input type='text' id='eventPlace' required><br>
          <label>Numero posti:</label><br>
          <input type='text' id='eventNPosti' required><br>
          <label>Prezzo biglietto:</label><br>
          <input type='text' id='eventPrice' required><br>
          <p style ="color:red" id="outputBox"></p>
        </form>
      <button class="bottone" onclick="inviaDati()"> Crea evento </button>
      <button class="bottoneCanc" onclick="annulla()"> Annulla </button>
    </div>
  </div>
</div>

</body>
</html>
