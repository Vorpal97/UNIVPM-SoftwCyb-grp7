<html>
  <head>
    <link rel='stylesheet'href='http://localhost:8080/style'>
      <meta charset="UTF-8">
  </head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <script type="text/javascript">
  var prezzo = ${evento.prezzoBiglietto};
  var address = "${address}";

  window.addEventListener("load", function(){
    document.getElementById("prezzoBiglietto").innerHTML = prezzo + " euro";
    document.getElementById("prezzoTotale").innerHTML = prezzo + " euro";

  });

    function acquista(){
      obj = {
        address : address,
        numeroBiglietti : document.getElementById("numBiglietti").value
      }
      console.log(obj)
      $.ajax({
         type: "POST",
         url: "http://localhost:8080/acquista",
         data: obj,
         success: function(d) {
           console.log(d)
           if(d.stato == "successo"){
             alert("Biglietti acquistati correttamente!");
             window.location.href='http://localhost:8080/visualizzaeventi';
           } else if(d.stato == "erroreqta"){
             alert("Non puoi acquistare più di 10 biglietti!");
             window.location.href='http://localhost:8080/visualizzaeventi';
           } else {
             alert("Si è verificato un errore!");
           }
         }
      });
    }

    function annulla(){
      window.location.href='http://localhost:8080/visualizzaeventi';
    }

    function incremento(){
      var qta = document.getElementById("numBiglietti").value
      if(/^\d+$/.test(qta)){
        if (qta > 10){
          document.getElementById("numBiglietti").value = 10
          qta = 10;
        }
        if (qta < 1){
          document.getElementById("numBiglietti").value = 1
          qta = 1;
        }
      } else {
        document.getElementById("numBiglietti").value = 1
        qta = 1;
      }

      document.getElementById("prezzoTotale").innerHTML = (prezzo * qta) + " euro";
    }
  </script>

  <body>

    <ul>
      <li><a href='http://localhost:8080/'>Home</a></li>
      <li><a href='http://localhost:8080/visualizzaeventi'>Visualizza eventi disponibili</a></li>
      <li><a href='http://localhost:8080/visualizzabiglietti'>I miei biglietti</a></li>
    </ul>

    <div style='padding:20px;margin-top:30px;background-color:#1abc9c;height:1500px;'>
      <div class="center">
        <div class="riquadro" style="width: fit-Content;">
          <h2>Acquista biglietti per quest'evento</h2><br>
          <table id="eventi">
            <tr><td> Nome evento</td><td>${evento.nome}</td></tr>
            <tr><td>Data dell'evento</td><td>${evento.data} </td></tr>
            <tr><td>Luogo dell'evento</td><td>${evento.luogo} </td></tr>
            <tr><td>Numero posti</td><td>${evento.numPosti}</td></tr>
            <tr><td>Posti disponibli</td><td>${evento.postiDisponibili} </td></tr>
            <tr><td>Numero biglietti</td><td><input type="number" id="numBiglietti" min="1" max="10" value="1" onchange="incremento()"></td></tr>
            <tr><td>Prezzo biglietto</td><td id="prezzoBiglietto"></td></tr>
            <tr><td>Prezzo Totale</td><td id="prezzoTotale"></td></tr>

          </table>
          <div style="margin-top: 20px">
            <button class="bottone" onClick="acquista()"> Conferma </button>
            <button class="bottoneCanc" onClick="annulla()"/> Annulla </button>
          </div>
        </div>
        <div>
    </div>
  </body>
</html>
